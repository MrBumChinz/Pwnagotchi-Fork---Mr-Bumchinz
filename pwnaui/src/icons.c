/*
 * PwnaUI - Icons Implementation
 * Static bitmap icons for UI elements
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdint.h>

#include "icons.h"
#include "renderer.h"

/*
 * Signal strength bars (4 levels)
 * 16x12 pixels each
 */
static const uint8_t icon_signal_0[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

static const uint8_t icon_signal_1[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x03, 0x00
};

static const uint8_t icon_signal_2[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x00,
    0x0C, 0x00, 0x0C, 0x00, 0x0F, 0x00, 0x0F, 0x00
};

static const uint8_t icon_signal_3[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x3C, 0x00,
    0x3C, 0x00, 0x3C, 0x00, 0x3F, 0x00, 0x3F, 0x00
};

static const uint8_t icon_signal_4[] = {
    0x00, 0x00, 0xC0, 0x00, 0xC0, 0x00, 0xC0, 0x00,
    0xF0, 0x00, 0xF0, 0x00, 0xF0, 0x00, 0xFC, 0x00,
    0xFC, 0x00, 0xFC, 0x00, 0xFF, 0x00, 0xFF, 0x00
};

/*
 * WiFi icon
 * 16x12 pixels
 */
static const uint8_t icon_wifi[] = {
    0x07, 0xE0, 0x1F, 0xF8, 0x38, 0x1C, 0x63, 0xC6,
    0x0F, 0xF0, 0x1C, 0x38, 0x01, 0x80, 0x07, 0xE0,
    0x06, 0x60, 0x00, 0x00, 0x01, 0x80, 0x01, 0x80
};

/*
 * Battery icons (empty, low, med, high, full, charging)
 * 20x10 pixels each
 */
static const uint8_t icon_battery_empty[] = {
    0xFF, 0xFC, 0x00, 0x80, 0x02, 0x00, 0x80, 0x03,
    0x00, 0x80, 0x03, 0x00, 0x80, 0x03, 0x00, 0x80,
    0x02, 0x00, 0xFF, 0xFC, 0x00
};

static const uint8_t icon_battery_low[] = {
    0xFF, 0xFC, 0x00, 0x80, 0x02, 0x00, 0x9C, 0x03,
    0x00, 0x9C, 0x03, 0x00, 0x9C, 0x03, 0x00, 0x80,
    0x02, 0x00, 0xFF, 0xFC, 0x00
};

static const uint8_t icon_battery_med[] = {
    0xFF, 0xFC, 0x00, 0x80, 0x02, 0x00, 0x9E, 0x03,
    0x00, 0x9E, 0x03, 0x00, 0x9E, 0x03, 0x00, 0x80,
    0x02, 0x00, 0xFF, 0xFC, 0x00
};

static const uint8_t icon_battery_high[] = {
    0xFF, 0xFC, 0x00, 0x80, 0x02, 0x00, 0x9F, 0x83,
    0x00, 0x9F, 0x83, 0x00, 0x9F, 0x83, 0x00, 0x80,
    0x02, 0x00, 0xFF, 0xFC, 0x00
};

static const uint8_t icon_battery_full[] = {
    0xFF, 0xFC, 0x00, 0x80, 0x02, 0x00, 0x9F, 0xC3,
    0x00, 0x9F, 0xC3, 0x00, 0x9F, 0xC3, 0x00, 0x80,
    0x02, 0x00, 0xFF, 0xFC, 0x00
};

static const uint8_t icon_battery_charging[] = {
    0xFF, 0xFC, 0x00, 0x80, 0x02, 0x00, 0x82, 0x03,
    0x00, 0x84, 0x03, 0x00, 0x9F, 0x03, 0x00, 0x84,
    0x02, 0x00, 0xFF, 0xFC, 0x00
};

/*
 * Lock/unlock icons
 * 12x14 pixels
 */
static const uint8_t icon_locked[] = {
    0x1E, 0x00, 0x33, 0x00, 0x21, 0x00, 0x21, 0x00,
    0x7F, 0x80, 0x7F, 0x80, 0x7F, 0x80, 0x7B, 0x80,
    0x73, 0x80, 0x7F, 0x80, 0x7F, 0x80, 0x7F, 0x80,
    0x7F, 0x80, 0x00, 0x00
};

static const uint8_t icon_unlocked[] = {
    0x1E, 0x00, 0x33, 0x00, 0x21, 0x00, 0x01, 0x00,
    0x7F, 0x80, 0x7F, 0x80, 0x7F, 0x80, 0x7B, 0x80,
    0x73, 0x80, 0x7F, 0x80, 0x7F, 0x80, 0x7F, 0x80,
    0x7F, 0x80, 0x00, 0x00
};

/*
 * Bluetooth icon
 * 8x14 pixels
 */
static const uint8_t icon_bluetooth[] = {
    0x08, 0x0C, 0x0A, 0x49, 0x2A, 0x1C, 0x08, 0x1C,
    0x2A, 0x49, 0x0A, 0x0C, 0x08, 0x00
};

/*
 * Plugin/gear icon
 * 14x14 pixels
 */
static const uint8_t icon_plugin[] = {
    0x03, 0x00, 0x03, 0x00, 0x1F, 0xE0, 0x30, 0x30,
    0x60, 0x18, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,
    0xCC, 0xCC, 0x60, 0x18, 0x30, 0x30, 0x1F, 0xE0,
    0x03, 0x00, 0x03, 0x00
};

/*
 * AI brain icon
 * 16x14 pixels
 */
static const uint8_t icon_ai[] = {
    0x07, 0xE0, 0x18, 0x18, 0x20, 0x04, 0x46, 0x62,
    0x49, 0x92, 0x49, 0x92, 0x46, 0x62, 0x40, 0x02,
    0x49, 0x92, 0x46, 0x62, 0x20, 0x04, 0x18, 0x18,
    0x07, 0xE0, 0x00, 0x00
};

/*
 * Icon table
 */
static const icon_t g_icons[] = {
    { "signal_0", 16, 12, icon_signal_0 },
    { "signal_1", 16, 12, icon_signal_1 },
    { "signal_2", 16, 12, icon_signal_2 },
    { "signal_3", 16, 12, icon_signal_3 },
    { "signal_4", 16, 12, icon_signal_4 },
    { "wifi", 16, 12, icon_wifi },
    { "battery_empty", 20, 10, icon_battery_empty },
    { "battery_low", 20, 10, icon_battery_low },
    { "battery_med", 20, 10, icon_battery_med },
    { "battery_high", 20, 10, icon_battery_high },
    { "battery_full", 20, 10, icon_battery_full },
    { "battery_charging", 20, 10, icon_battery_charging },
    { "locked", 12, 14, icon_locked },
    { "unlocked", 12, 14, icon_unlocked },
    { "bluetooth", 8, 14, icon_bluetooth },
    { "plugin", 14, 14, icon_plugin },
    { "ai", 16, 14, icon_ai },
};

#define NUM_ICONS (sizeof(g_icons) / sizeof(g_icons[0]))

/*
 * Initialize icon system
 */
int icons_init(void) {
    /* All icons are statically allocated, nothing to do */
    return 0;
}

/*
 * Cleanup icon resources
 */
void icons_cleanup(void) {
    /* Nothing to cleanup with static allocation */
}

/*
 * Get icon by name
 */
const icon_t *icons_get(const char *name) {
    if (!name) return NULL;
    
    for (size_t i = 0; i < NUM_ICONS; i++) {
        if (strcmp(g_icons[i].name, name) == 0) {
            return &g_icons[i];
        }
    }
    
    return NULL;
}

/*
 * Get icon by index
 */
const icon_t *icons_get_by_index(int index) {
    if (index < 0 || (size_t)index >= NUM_ICONS) {
        return NULL;
    }
    return &g_icons[index];
}

/*
 * Get total number of icons
 */
int icons_count(void) {
    return (int)NUM_ICONS;
}

/*
 * Draw icon to framebuffer
 */
void icons_draw(uint8_t *framebuffer, const char *name, int x, int y) {
    const icon_t *icon = icons_get(name);
    if (!icon) return;
    
    int width = renderer_get_width();
    int height = renderer_get_height();
    int row_bytes = (icon->width + 7) / 8;
    
    for (int iy = 0; iy < icon->height; iy++) {
        int dst_y = y + iy;
        if (dst_y < 0 || dst_y >= height) continue;
        
        for (int ix = 0; ix < icon->width; ix++) {
            int dst_x = x + ix;
            if (dst_x < 0 || dst_x >= width) continue;
            
            /* Get source pixel from icon bitmap */
            int src_byte = iy * row_bytes + ix / 8;
            int src_bit = 7 - (ix % 8);
            int pixel = (icon->bitmap[src_byte] >> src_bit) & 1;
            
            /* Set pixel in framebuffer (0 = black, 1 = white) */
            /* Icons are drawn as black-on-white */
            if (pixel) {
                renderer_set_pixel(framebuffer, width, dst_x, dst_y, 0);
            }
        }
    }
}
